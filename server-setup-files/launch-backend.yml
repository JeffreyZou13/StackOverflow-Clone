---
- name: StackOverflow Backend
  hosts: 127.0.0.1
  connection: local
  become: yes
  become_method: sudo
  tasks:
    - name: install nginx
      apt: name=nginx state=latest
    - name: start nginx
      service:
        name: nginx
        state: started
    - name: install node
      apt: name=nodejs state=latest
    - name: install npm
      apt: name=npm
    - name: upgrade npm
      command: npm install -g npm
    - name: install required backend packages
      command: npm install ../back-end
    - name: Install PM2
      npm:
        name: pm2
        state: latest
        global: yes
    - name: Run PM@
      command: pm2 start ../back-end